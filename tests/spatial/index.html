<!DOCTYPE HTML>
<html>
<head>
  <title>Fullscreen: test page</title>
  <script>
    async function toggleFullScreen(element) {
        var mode = element.webkitPresentationMode;
        if (!element.fullscreenElement) {
            if (!!element.requestFullscreen)
                await element.requestFullscreen();
            else if (!!element.webkitEnterFullscreen)
                element.webkitEnterFullscreen();
        }
        else if (document.exitFullscreen)
            document.exitFullscreen();
    }

    window.onload = async function() {
        const id = 'log';

        video1.src = "../../mediatest/mp4/spatial/cat.mov";
        video1.preload = "auto";

        let button1 = document.createElement("BUTTON");
        button1.innerText = "Video Fullscreen";
        crabs.appendChild(button1);
        button1.onclick = toggleFullScreen.bind(null, video1);

        let button2 = document.createElement("BUTTON");
        button2.innerText = "Div Element Fullscreen";
        crabs.appendChild(button2);
        button2.onclick = toggleFullScreen.bind(null, videodiv1);

        let button3 = document.createElement("BUTTON");
        button3.innerText = "Video Fullscreen";
        mse.appendChild(button3);
        button3.onclick = toggleFullScreen.bind(null, video2);

        let button4 = document.createElement("BUTTON");
        button4.innerText = "Div Element Fullscreen";
        mse.appendChild(button4);
        button4.onclick = toggleFullScreen.bind(null, videodiv2);

        if (!!!window.ManagedMediaSource)
            return;
        video2.disableRemotePlayback = true;
        var source = new ManagedMediaSource();
        await new Promise((resolve) => {
            video2.src = URL.createObjectURL(source);
            source.addEventListener("sourceopen", resolve, { once: true });
        });
        var sourceBuffer = source.addSourceBuffer('video/mp4; codecs="hev1.1.6.L93.B0,avc1.4d4015"');
        const response = await fetch("../../mediatest/mp4/spatial/trees.mp4");
        const buffer = await response.arrayBuffer();
        const initSegment = buffer.slice(0, 3723);
        const mediaSegment = buffer.slice(3723);
        await new Promise((resolve) => {
            sourceBuffer.addEventListener("updateend", resolve, { once: true });
            sourceBuffer.appendBuffer(initSegment);
        });
        await new Promise((resolve) => {
            sourceBuffer.addEventListener("updateend", resolve, { once: true });
            sourceBuffer.appendBuffer(mediaSegment);
        });
        source.endOfStream();
    }
    </script>
<body>
    <h1>Spatial Video Example. native vs element fullscreen</h1>
    <h2>HTML5 video with MP4 video</h2>
    <div id="crabs">
        <div id="videodiv1" style="width: 320px; height: 240px">
            <video id='video1' style="object-fit: cover;" width="100%" height="100%" playsinline loop controls></video>
        </div>
    </div>
    <h2>HTML5 video with MSE video</h2>
    <div id="mse">
        <div id="videodiv2" style="width: 320px; height: 240px">
            <video id='video2' style="object-fit: cover;" width="100%" height="100%" playsinline loop controls></video>
        </div>
    </div>
</body>
</html>
